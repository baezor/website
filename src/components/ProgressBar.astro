---
import { getLangFromUrl, useTranslations } from "@/i18n/utils";

interface Props {
  current: number;
  goal: number;
  percentComplete: number;
}

const { current, goal, percentComplete } = Astro.props;

const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);

// Cap percentage at 100% for display
const displayPercent = Math.min(100, percentComplete);
---

<div class="progress-container">
  <div class="progress-bar-track">
    <div class="progress-bar-fill" style={`width: ${displayPercent}%`}>
      <span class="progress-percentage">{displayPercent.toFixed(1)}%</span>
    </div>
  </div>
  <div class="progress-stats">
    <span class="stat">{current.toFixed(1)} km {t('run.progress.of')} {goal} km</span>
  </div>
</div>

<style>
  .progress-container {
    background-color: var(--color-bg-elevated);
    padding: 2rem;
    border-radius: 0.5rem;
    margin-bottom: 2rem;
  }

  .progress-bar-track {
    position: relative;
    width: 100%;
    height: 3rem;
    background-color: color-mix(in srgb, var(--color-text) 10%, transparent);
    border-radius: 9999px;
    overflow: hidden;
  }

  .progress-bar-fill {
    position: relative;
    height: 100%;
    background: linear-gradient(90deg, var(--color-accent), var(--color-accent-hover));
    border-radius: 9999px;
    transition: width 1s cubic-bezier(0.4, 0, 0.2, 1);
    display: flex;
    align-items: center;
    justify-content: center;
    min-width: fit-content;
    padding: 0 1rem;
  }

  .progress-percentage {
    color: var(--color-bg);
    font-family: var(--font-heading);
    font-size: 1.125rem;
    font-weight: 700;
    letter-spacing: 0.5px;
    text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
  }

  .progress-stats {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 0.75rem;
    margin-top: 1rem;
    font-family: var(--font-heading);
    font-size: 1rem;
    color: var(--color-text-muted);
  }

  .stat {
    font-weight: 600;
  }

  .stat-divider {
    opacity: 0.5;
  }

  @media (max-width: 768px) {
    .progress-container {
      padding: 1.5rem;
    }

    .progress-bar-track {
      height: 2.5rem;
    }

    .progress-percentage {
      font-size: 1rem;
    }

    .progress-stats {
      font-size: 0.9rem;
    }
  }
</style>
